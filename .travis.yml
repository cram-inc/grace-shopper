language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '10' # recent postgres version on Travis
dist: xenial # uses xenial environment
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "cram-inc-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)
script:
  - npm test # test the code
  - npm run build-client # make the bundle
before_deploy: # omit node_modules, since we set skip_cleanup below
  - rm -rf node_modules
deploy: # see README for details on these keys
  # prevents travis from deleting the build
  skip_cleanup: true
  provider: heroku
  # app should be your heroku app name; see README
  app: cram-inc
  # the secure key indicates an encrypted value; see README
  api_key:
    secure: jx66q2E+mrDQEEB/u8+u2kIXePKlrJdfGX0OoQ0ssfT+47VFh8Kw5TknANd/jF9yOa+LJ+oXI8xP5FsDsK/Y4zVcRTRmm7/FN5bQ2hHUR4QZz8rbH5qT/J03Ze55oUvWRu6YoNkAxU/sH4ZsE0mHldegbVlZQbtSVBB6HTvFqPp1lPwTKmTO+OkLUVO9PLPxKCKEBPZCn/XMMhEmkjkOIJZ4nHyBHC6Tt9SCFkaG5G7O7+AFLp3wUicbDmf3I8RQrEhOqmbW2VaEEWMFn+Zq9F1HvQuEYAG9YYn2MRbSinFFzwHEi7B67sYl80LE37Dekn98qhVodLpZ5hySwo9wJ28Cs5oVG161qDCoeFgmdHJ93HBcqP6dtEHCsqWOz2nloYHFgRMC05RzxIxsqvVx7VmUcTEy3qKmHa5vATTozpUbsV3TNgO7jAUDCS7l3TAZsDlPZ6Ejs5o67lJhENfGmtSfPHNRo9Qf+iHR0wITKYyqWFsmvkB1Ps9Hc21NJBnSv4bsrqOOiPO+ttVExPZcerT/eZ7tVZjds5pCI/TKNcoV7FON5bAFVcdrdGtpu0UpQkRN5LxGFnfkT7FlOySLip/h8UIsCR4YO2KU8tmM/kpd3IAnwzY1mMNFiB/6mEobewVdkMAW3vlksgiDwHWaqb7GU6sXtCrIsCm8LxBslDE=
